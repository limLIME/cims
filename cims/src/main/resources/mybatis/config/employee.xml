<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="employee">

	<resultMap type="employeeVO" id="employeeMap">
		<id property="empNo" column="emp_no" />
		<result property="empName" column="emp_name" />
		<result property="password" column="password" />
		<result property="empTel" column="emp_tel" />
		<result property="empSign" column="emp_sign" />
		<result property="positionVO.positionName" column="position_name" />
		<result property="positionVO.positionNo" column="position_no" />
		<result property="departmentVO.deptName" column="dept_name" />
		<result property="departmentVO.deptNo" column="dept_no" />
	</resultMap>


	<select id="login" resultMap="employeeMap" parameterType="employeeVO">
		SELECT emp_no,dept_no,position_no,password,emp_name,emp_tel,emp_sign
		FROM employee
		where emp_no=#{empNo} and password=#{password}
	</select>

	<update id="update" parameterType="employeeVO">
		update employee set password=#{password}, emp_tel=#{empTel},
		emp_sign=#{empSign}
		where emp_no=#{empNo} and password=#{password}
	</update>

	<insert id="register" parameterType="employeeVO">
		insert into
		employee(emp_no,password,emp_name,emp_tel,emp_sign,dept_no,position_no)
		values(#{empNo},#{password},#{empName},#{empTel},#{empSign},#{departmentVO.deptNo},#{positionVO.positionNo})
	</insert>
	
	<select id="findApprover" resultMap="employeeMap">
		SELECT
		e.emp_no,d.dept_name,p.position_name,e.password,e.emp_name,e.emp_tel,e.emp_sign
		FROM employee e, department d ,position p
		where e.dept_no=#{deptNo} and e.position_no=#{positionNo}+1
		and d.dept_no=e.dept_no and p.position_no=e.position_no
	</select>

	 <select id="findByName" resultMap="employeeMap">
      select d.dept_name, p.position_name, e.emp_name, e.emp_no 
      from employee e, department d, position p 
      where e.dept_no=d.dept_no and e.position_no = p.position_no and e.position_no > 0 
      and (e.emp_name like '%' || #{value} || '%' or e.emp_no like '%' || #{value} || '%')
   </select>
   
   <update id="deleteEmp" >
         update employee set position_no=0 where emp_no=#{empNo}
   </update>
   
</mapper>




